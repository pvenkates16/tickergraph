<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Waste Sector Driver Graph</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    h2 {
      padding: 1em;
      text-align: center;
    }
    svg {
      width: 100%;
      height: 100vh;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
  <h2>Force-Directed Graph: WM & Peers vs Drivers</h2>
  <svg></svg>

  <script>
    const nodes = [
      { id: "WM", group: "company" },
      { id: "RSG", group: "company" },
      { id: "WCN", group: "company" },
      { id: "CLH", group: "company" },
      { id: "CWST", group: "company" },
      { id: "Core Waste Ops", group: "driver" },
      { id: "Landfill Services", group: "driver" },
      { id: "Recycling Services", group: "driver" },
      { id: "Plastic Recycling", group: "driver" },
      { id: "Metal Recycling", group: "driver" },
      { id: "Environmental Services", group: "driver" },
      { id: "Clean Tech", group: "driver" },
      { id: "Sustainable Logistics", group: "driver" },
      { id: "Commodity Exposure", group: "anti" },
      { id: "Regulatory Risk", group: "anti" },
      { id: "Labor/Fuel Cost Risk", group: "anti" },
      { id: "Capital Intensity", group: "anti" }
    ];

    const links = [
      // WM
      { source: "WM", target: "Core Waste Ops", value: 10 },
      { source: "WM", target: "Landfill Services", value: 10 },
      { source: "WM", target: "Recycling Services", value: 7 },
      { source: "WM", target: "Plastic Recycling", value: 7 },
      { source: "WM", target: "Metal Recycling", value: 5 },
      { source: "WM", target: "Environmental Services", value: 6 },
      { source: "WM", target: "Clean Tech", value: 5 },
      { source: "WM", target: "Sustainable Logistics", value: 6 },
      { source: "WM", target: "Commodity Exposure", value: -6 },
      { source: "WM", target: "Regulatory Risk", value: -5 },
      { source: "WM", target: "Labor/Fuel Cost Risk", value: -5 },
      { source: "WM", target: "Capital Intensity", value: -4 },

      // RSG
      { source: "RSG", target: "Core Waste Ops", value: 9 },
      { source: "RSG", target: "Landfill Services", value: 9 },
      { source: "RSG", target: "Recycling Services", value: 6 },
      { source: "RSG", target: "Plastic Recycling", value: 6 },
      { source: "RSG", target: "Clean Tech", value: 4 },
      { source: "RSG", target: "Commodity Exposure", value: -5 },
      { source: "RSG", target: "Regulatory Risk", value: -4 },
      { source: "RSG", target: "Labor/Fuel Cost Risk", value: -5 },

      // WCN
      { source: "WCN", target: "Core Waste Ops", value: 9 },
      { source: "WCN", target: "Landfill Services", value: 8 },
      { source: "WCN", target: "Recycling Services", value: 6 },
      { source: "WCN", target: "Clean Tech", value: 4 },
      { source: "WCN", target: "Commodity Exposure", value: -5 },
      { source: "WCN", target: "Regulatory Risk", value: -4 },
      { source: "WCN", target: "Labor/Fuel Cost Risk", value: -4 },

      // CLH
      { source: "CLH", target: "Environmental Services", value: 10 },
      { source: "CLH", target: "Clean Tech", value: 7 },
      { source: "CLH", target: "Metal Recycling", value: 6 },
      { source: "CLH", target: "Commodity Exposure", value: -4 },
      { source: "CLH", target: "Regulatory Risk", value: -6 },

      // CWST
      { source: "CWST", target: "Recycling Services", value: 7 },
      { source: "CWST", target: "Plastic Recycling", value: 6 },
      { source: "CWST", target: "Environmental Services", value: 6 },
      { source: "CWST", target: "Clean Tech", value: 5 },
      { source: "CWST", target: "Commodity Exposure", value: -6 },
      { source: "CWST", target: "Regulatory Risk", value: -5 }
    ];

    const svg = d3.select("svg"),
          width = window.innerWidth,
          height = window.innerHeight;

    const color = d3.scaleOrdinal()
      .domain(["company", "driver", "anti"])
      .range(["#1f77b4", "#2ca02c", "#d62728"]);

    const container = svg.append("g");

    const link = container.append("g")
      .attr("stroke", "#aaa")
      .attr("stroke-opacity", 0.6)
      .selectAll("line")
      .data(links)
      .join("line")
      .attr("stroke-width", d => Math.sqrt(Math.abs(d.value)));

    const node = container.selectAll("circle")
      .data(nodes)
      .join("circle")
      .attr("r", 10)
      .attr("fill", d => color(d.group))
      .call(drag(simulation));

    const label = container.selectAll("text")
      .data(nodes)
      .join("text")
      .text(d => d.id)
      .attr("dx", 12)
      .attr("dy", "0.35em")
      .style("font-size", "12px");

    const simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id).distance(140))
      .force("charge", d3.forceManyBody().strength(-500))
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collide", d3.forceCollide(40))
      .on("tick", ticked);

    function ticked() {
      link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

      node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y);

      label
        .attr("x", d => d.x)
        .attr("y", d => d.y);
    }

    function drag(simulation) {
      return d3.drag()
        .on("start", (event, d) => {
          if (!event.active) simulation.alphaTarget(0.3).restart();
          d.fx = d.x;
          d.fy = d.y;
        })
        .on("drag", (event, d) => {
          d.fx = event.x;
          d.fy = event.y;
        })
        .on("end", (event, d) => {
          if (!event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
        });
    }

    // Zoom and pan
    svg.call(d3.zoom()
      .scaleExtent([0.5, 4])
      .on("zoom", ({ transform }) => {
        container.attr("transform", transform);
      }));
  </script>
</body>
</html>

